<!doctype html>
<html>
   <head>
        <link rel = "stylesheet" type = "text/css" href = "{{ url_for('static',filename='styles/accountInfo.css') }}">
        <link rel = "stylesheet" type = "text/css" href = "{{ url_for('static',filename='styles/main.css') }}">
        <script type = "text/javascript" src = "https://www.google.com/jsapi"></script>
        <script type = "text/javascript">
        {% block body %}

        google.load('visualization', '1', {packages: ['corechart', 'bar']});
        google.setOnLoadCallback(loadCharts);

        function loadCharts()
        {
            usageChart();
            typesChart();
            foldersChart(); // <--- NEW Function Call
        }

        function usageChart()
        {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Types');
            data.addColumn('number', 'Size (MB)');
            data.addRow(['Used (MB)', {{ used }}]);
            data.addRow(['Free (MB)', {{ free }}]);

            var options =
            {
                title: 'Total Account Space',
                slices: {0 : { color: 'silver' }, 1 : { color: 'gold' }}
            };

            var chart = new google.visualization.PieChart(document.getElementById('spaceUsage'));
            chart.draw(data, options);
        }

        function typesChart()
        {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Types');
            data.addColumn('number', 'Size (KB)');
            data.addColumn({type:'string', role:'style'});

            {% for size, color, type in rows %}
                data.addRow(['{{ type }}', {{ size }}, 'color: {{ color }}']);
            {% endfor %}

            var options =
            {
                title: 'Largest File Types',
                hAxis: { title: 'Size (KB)', minValue: 0 },
                vAxis: { title: 'File Types' },
                legend: { position: 'none' }
            };

            var chart = new google.visualization.BarChart(document.getElementById('fileTypes'));
            chart.draw(data, options);
        }
        
        // --- NEW: Folders Chart ---
        function foldersChart()
        {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Folder');
            data.addColumn('number', 'Size (MB)');
            data.addColumn({type:'string', role:'style'});

            {% for path, size, color in folder_rows %}
                // Convert KB to MB for cleaner reading on folders
                data.addRow(['{{ path }}', {{ size / 1024 }}, 'color: {{ color }}']);
            {% endfor %}

            var options =
            {
                title: 'Largest Folders (Cumulative)',
                hAxis: { title: 'Size (MB)', minValue: 0 },
                vAxis: { title: 'Folder Path' },
                legend: { position: 'none' },
                chartArea: { left: '30%', width: '60%' } // Give more room for long folder paths
            };

            var chart = new google.visualization.BarChart(document.getElementById('folderSizes'));
            chart.draw(data, options);
        }

        {% endblock %}
        </script>
   </head>
   <body>
      <h2 style="text-align:center;">Space Analysis</h2>
      
      <div id = "spaceUsage" style = "width: 800px; height: 350px; margin: 0 auto;"></div>
      
      <div style="display:flex; justify-content: center; flex-wrap: wrap;">
          <div id = "fileTypes" style = "width: 600px; height: 400px; margin: 10px;"></div>
          <div id = "folderSizes" style = "width: 600px; height: 400px; margin: 10px;"></div>
      </div>

      <div class = "formStyle" style="margin-top: 20px;">
        <form action = "/" method = "GET">
            <input type = "submit" value = "Back to Dashboard" class = "buttonNormal" />
        </form>
      </div>
   </body>
</html>
